<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - Vinyl Store</title>
    <style>
        /* –°–¢–ò–õ–ò –î–õ–Ø –ê–î–ú–ò–ù–ö–ò */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #FFF0F5;
        }
        
        .navbar {
            background: linear-gradient(135deg, #8B008B, #FF69B4);
            padding: 1rem 2rem;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 1rem;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
        }
        
        .admin-container {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #FF69B4;
            padding-bottom: 10px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #FF69B4;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: #8B008B;
        }
        
        .tab-btn.active {
            background: #8B008B;
            color: white;
            border-color: #8B008B;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(139, 0, 139, 0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #FFE4E9;
        }
        
        th {
            background: #8B008B;
            color: white;
        }
        
        .btn {
            padding: 5px 10px;
            background: #FF69B4;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .status {
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .status-pending { background: #FFEAA7; color: #E17055; }
        .status-processing { background: #74B9FF; color: #0984E3; }
        .status-shipped { background: #A29BFE; color: #6C5CE7; }
        .status-delivered { background: #55EFC4; color: #00B894; }
    </style>
</head>
<body>
    <!-- –®–ê–ü–ö–ê -->
    <header>
        <nav class="navbar">
            <div>
                <h1 style="margin: 0;">‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Vinyl Store</h1>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">üè† –ú–∞–≥–∞–∑–∏–Ω</a></li>
                <li><a href="dashboard.html">üë§ –ö–∞–±–∏–Ω–µ—Ç</a></li>
                <li><a href="#" onclick="logout()">üö™ –í—ã–π—Ç–∏</a></li>
            </ul>
        </nav>
    </header>

    <!-- –û–°–ù–û–í–ù–û–ï –°–û–î–ï–†–ñ–ò–ú–û–ï -->
    <div class="admin-container">
        <!-- –¢–ê–ë–´ -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('customers')">üë• –ö–ª–∏–µ–Ω—Ç—ã</button>
            <button class="tab-btn" onclick="showTab('orders')">üì¶ –í—Å–µ –∑–∞–∫–∞–∑—ã</button>
            <button class="tab-btn" onclick="showTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>
        
        <!-- –í–ö–õ–ê–î–ö–ê –ö–õ–ò–ï–ù–¢–´ -->
        <div id="customers-tab" class="tab-content active">
            <h2>üë• –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã</h2>
            <div id="customers-list">
                <!-- –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
        
        <!-- –í–ö–õ–ê–î–ö–ê –ó–ê–ö–ê–ó–´ -->
        <div id="orders-tab" class="tab-content">
            <h2>üì¶ –í—Å–µ –∑–∞–∫–∞–∑—ã</h2>
            <div id="orders-list">
                <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
        
        <!-- –í–ö–õ–ê–î–ö–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <div id="stats-tab" class="tab-content">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞</h2>
            <div id="stats-content">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <!-- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –°–ö–†–ò–ü–¢–û–í -->
    <script src="auth.js"></script>
    <script>
        // ===== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîê –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (!auth.currentUser) {
                alert('‚ùå –í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã!');
                window.location.href = 'login.html';
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å (—Ç–æ–ª—å–∫–æ –º–µ–Ω–µ–¥–∂–µ—Ä)
            if (auth.currentUser.role !== 'manager') {
                alert('‚ùå –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞!');
                window.location.href = 'dashboard.html';
                return;
            }
            
            console.log('‚úÖ –ú–µ–Ω–µ–¥–∂–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', auth.currentUser.name);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadAllData();
        });
        
        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            if (auth && auth.logout) {
                auth.logout();
            } else {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–π –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'customers') {
                loadCustomers();
            } else if (tabName === 'orders') {
                loadAllOrders();
            } else if (tabName === 'stats') {
                loadStatistics();
            }
        }
        
        // ===== –ó–ê–ì–†–£–ó–ö–ê –í–°–ï–• –î–ê–ù–ù–´–• =====
        function loadAllData() {
            console.log('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ...');
            loadCustomers();
            loadAllOrders();
            loadStatistics();
        }
        
        // ===== –ö–õ–ò–ï–ù–¢–´ =====
        function loadCustomers() {
            console.log('üë• –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤...');
            
            const users = auth.getUsers();
            const customers = users.filter(user => 
                user.role === 'customer' || !user.role
            );
            
            console.log('–ù–∞–π–¥–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤:', customers.length);
            
            if (customers.length === 0) {
                document.getElementById('customers-list').innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <p style="font-size: 3rem;">üë§</p>
                        <h3>–ö–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                        <p>–ö–ª–∏–µ–Ω—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</p>
                    </div>
                `;
                return;
            }
            
            let html = '<table>';
            html += `
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–§–ò–û</th>
                        <th>Email</th>
                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                        <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                        <th>–ó–∞–∫–∞–∑–æ–≤</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            customers.forEach(customer => {
                const orderCount = customer.orders ? customer.orders.length : 0;
                const totalSpent = customer.orders ? 
                    customer.orders.reduce((sum, order) => sum + (order.total || 0), 0) : 0;
                
                html += `
                    <tr>
                        <td>${customer.id || '–ù/–î'}</td>
                        <td><strong>${customer.name}</strong></td>
                        <td>${customer.email}</td>
                        <td>${customer.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                        <td>${new Date(customer.registrationDate || Date.now()).toLocaleDateString()}</td>
                        <td>
                            <span style="color: #8B008B; font-weight: bold;">${orderCount}</span>
                            <br>
                            <small>${totalSpent.toFixed(2)} ‚ÇΩ</small>
                        </td>
                        <td>
                            <button class="btn" onclick="viewCustomerOrders(${customer.id})">
                                üëÅÔ∏è –ó–∞–∫–∞–∑—ã
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            document.getElementById('customers-list').innerHTML = html;
        }
        
        // ===== –í–°–ï –ó–ê–ö–ê–ó–´ =====
        function loadAllOrders() {
            console.log('üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∑–∞–∫–∞–∑—ã...');
            
            const users = auth.getUsers();
            let allOrders = [];
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–∞–∫–∞–∑—ã –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            users.forEach(user => {
                if (user.orders && user.orders.length > 0) {
                    user.orders.forEach(order => {
                        allOrders.push({
                            ...order,
                            customerName: user.name,
                            customerEmail: user.email,
                            customerPhone: user.phone,
                            customerId: user.id
                        });
                    });
                }
            });
            
            console.log('–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤:', allOrders.length);
            
            if (allOrders.length === 0) {
                document.getElementById('orders-list').innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <p style="font-size: 3rem;">üì¶</p>
                        <h3>–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                        <p>–ó–∞–∫–∞–∑—ã –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–æ–∫</p>
                    </div>
                `;
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
            allOrders.sort((a, b) => {
                const dateA = a.date ? new Date(a.date) : new Date(a.id || 0);
                const dateB = b.date ? new Date(b.date) : new Date(b.id || 0);
                return dateB - dateA;
            });
            
            let html = '<table>';
            html += `
                <thead>
                    <tr>
                        <th>ID –∑–∞–∫–∞–∑–∞</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                        <th>–¢–æ–≤–∞—Ä—ã</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            allOrders.forEach(order => {
                // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
                const totalItems = order.items ? 
                    order.items.reduce((sum, item) => sum + (item.quantity || 1), 0) : 0;
                
                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å
                const statusText = getStatusText(order.status);
                const statusClass = getStatusClass(order.status);
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–ø–µ—Ä–≤—ã–µ 2)
                let itemsText = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                if (order.items && order.items.length > 0) {
                    const firstItems = order.items.slice(0, 2);
                    itemsText = firstItems.map(item => 
                        `${item.name} (${item.quantity || 1} —à—Ç.)`
                    ).join(', ');
                    
                    if (order.items.length > 2) {
                        itemsText += ` +${order.items.length - 2} –µ—â–µ`;
                    }
                }
                
                html += `
                    <tr>
                        <td><strong>#${order.id}</strong></td>
                        <td>${new Date(order.date || order.id || Date.now()).toLocaleDateString()}</td>
                        <td>${order.customerName}</td>
                        <td>${order.customerPhone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                        <td title="${order.items ? order.items.map(i => i.name).join(', ') : ''}">
                            ${itemsText}
                        </td>
                        <td><strong>${order.total ? order.total.toFixed(2) : '0.00'} ‚ÇΩ</strong></td>
                        <td>
                            <span class="status ${statusClass}">${statusText}</span>
                            <br>
                            <select onchange="updateOrderStatus(${order.id}, this.value)" style="margin-top: 5px; padding: 3px; font-size: 0.9em;">
                                <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                                <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>–°–æ–±–∏—Ä–∞–µ—Ç—Å—è</option>
                                <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</option>
                                <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                            </select>
                        </td>
                        <td>
                            <button class="btn" onclick="viewOrderDetails(${order.id})">
                                üîç –î–µ—Ç–∞–ª–∏
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            document.getElementById('orders-list').innerHTML = html;
        }
        
        // ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê =====
        function loadStatistics() {
            console.log('üìä –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É...');
            
            const users = auth.getUsers();
            const customers = users.filter(u => u.role === 'customer' || !u.role);
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–∞–∫–∞–∑—ã
            let allOrders = [];
            let totalRevenue = 0;
            let totalItems = 0;
            
            users.forEach(user => {
                if (user.orders) {
                    allOrders = [...allOrders, ...user.orders];
                    user.orders.forEach(order => {
                        totalRevenue += order.total || 0;
                        if (order.items) {
                            totalItems += order.items.reduce((sum, item) => sum + (item.quantity || 1), 0);
                        }
                    });
                }
            });
            
            // –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
            const statusCounts = {
                pending: allOrders.filter(o => o.status === 'pending').length,
                processing: allOrders.filter(o => o.status === 'processing').length,
                shipped: allOrders.filter(o => o.status === 'shipped').length,
                delivered: allOrders.filter(o => o.status === 'delivered').length
            };
            
            const html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #8B008B;">
                        <h3 style="color: #8B008B; margin-top: 0;">üë• –ö–ª–∏–µ–Ω—Ç—ã</h3>
                        <p style="font-size: 2.5rem; font-weight: bold; color: #FF69B4; margin: 10px 0;">${customers.length}</p>
                        <p>–í—Å–µ–≥–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ</p>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #FF69B4;">
                        <h3 style="color: #8B008B; margin-top: 0;">üì¶ –ó–∞–∫–∞–∑—ã</h3>
                        <p style="font-size: 2.5rem; font-weight: bold; color: #DB7093; margin: 10px 0;">${allOrders.length}</p>
                        <p>–í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</p>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #DB7093;">
                        <h3 style="color: #8B008B; margin-top: 0;">üí∞ –í—ã—Ä—É—á–∫–∞</h3>
                        <p style="font-size: 2.5rem; font-weight: bold; color: #8B008B; margin: 10px 0;">${totalRevenue.toFixed(2)} ‚ÇΩ</p>
                        <p>–û–±—â–∞—è —Å—É–º–º–∞</p>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #C71585;">
                        <h3 style="color: #8B008B; margin-top: 0;">üéµ –¢–æ–≤–∞—Ä—ã</h3>
                        <p style="font-size: 2.5rem; font-weight: bold; color: #C71585; margin: 10px 0;">${totalItems}</p>
                        <p>–í—Å–µ–≥–æ –ø—Ä–æ–¥–∞–Ω–æ</p>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>üìà –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background: #FFEAA7; padding: 15px; border-radius: 8px;">
                            <strong>‚è≥ –í –æ–±—Ä–∞–±–æ—Ç–∫–µ</strong>
                            <p style="font-size: 1.5rem; margin: 5px 0;">${statusCounts.pending}</p>
                        </div>
                        <div style="background: #74B9FF; padding: 15px; border-radius: 8px;">
                            <strong>üì¶ –°–æ–±–∏—Ä–∞–µ—Ç—Å—è</strong>
                            <p style="font-size: 1.5rem; margin: 5px 0;">${statusCounts.processing}</p>
                        </div>
                        <div style="background: #A29BFE; padding: 15px; border-radius: 8px;">
                            <strong>üöö –û—Ç–ø—Ä–∞–≤–ª–µ–Ω</strong>
                            <p style="font-size: 1.5rem; margin: 5px 0;">${statusCounts.shipped}</p>
                        </div>
                        <div style="background: #55EFC4; padding: 15px; border-radius: 8px;">
                            <strong>‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω</strong>
                            <p style="font-size: 1.5rem; margin: 5px 0;">${statusCounts.delivered}</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn" onclick="exportData()" style="padding: 10px 20px; background: #00B894;">
                        üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                    </button>
                </div>
            `;
            
            document.getElementById('stats-content').innerHTML = html;
        }
        
        // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
        function getStatusText(status) {
            switch(status) {
                case 'pending': return '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ';
                case 'processing': return '–°–æ–±–∏—Ä–∞–µ—Ç—Å—è';
                case 'shipped': return '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω';
                case 'delivered': return '–î–æ—Å—Ç–∞–≤–ª–µ–Ω';
                default: return '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ';
            }
        }
        
        function getStatusClass(status) {
            switch(status) {
                case 'pending': return 'status-pending';
                case 'processing': return 'status-processing';
                case 'shipped': return 'status-shipped';
                case 'delivered': return 'status-delivered';
                default: return 'status-pending';
            }
        }
        
        // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–ù–û–ü–û–ö =====
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞
        function viewCustomerOrders(customerId) {
            console.log('üëÄ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –∑–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–∞:', customerId);
            
            const users = auth.getUsers();
            const customer = users.find(u => u.id === customerId);
            
            if (!customer) {
                alert('‚ùå –ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            if (!customer.orders || customer.orders.length === 0) {
                alert(`üì≠ –£ –∫–ª–∏–µ–Ω—Ç–∞ ${customer.name} –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤`);
                return;
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∑–∞–∫–∞–∑–æ–≤
            showTab('orders');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–∫–∞–∑—ã —Ç–æ–ª—å–∫–æ —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
            setTimeout(() => {
                const filteredOrders = customer.orders.map(order => ({
                    ...order,
                    customerName: customer.name,
                    customerEmail: customer.email,
                    customerPhone: customer.phone,
                    customerId: customer.id
                }));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
                let html = '<h3>üìã –ó–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–∞: ' + customer.name + '</h3>';
                html += '<button class="btn" onclick="loadAllOrders()" style="margin-bottom: 15px;">‚Üê –í—Å–µ –∑–∞–∫–∞–∑—ã</button>';
                html += '<table>';
                html += `
                    <thead>
                        <tr>
                            <th>ID –∑–∞–∫–∞–∑–∞</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–¢–æ–≤–∞—Ä—ã</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                `;
                
                filteredOrders.forEach(order => {
                    const totalItems = order.items ? 
                        order.items.reduce((sum, item) => sum + (item.quantity || 1), 0) : 0;
                    
                    html += `
                        <tr>
                            <td><strong>#${order.id}</strong></td>
                            <td>${new Date(order.date || order.id || Date.now()).toLocaleDateString()}</td>
                            <td>${totalItems} —à—Ç.</td>
                            <td><strong>${order.total ? order.total.toFixed(2) : '0.00'} ‚ÇΩ</strong></td>
                            <td><span class="status ${getStatusClass(order.status)}">${getStatusText(order.status)}</span></td>
                            <td>
                                <button class="btn" onclick="viewOrderDetails(${order.id})">
                                    üîç –î–µ—Ç–∞–ª–∏
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                document.getElementById('orders-list').innerHTML = html;
            }, 100);
        }
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞
        function viewOrderDetails(orderId) {
            console.log('üîç –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ #' + orderId);
            
            const users = auth.getUsers();
            let order = null;
            let customer = null;
            
            // –ò—â–µ–º –∑–∞–∫–∞–∑ —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            for (const user of users) {
                if (user.orders) {
                    const foundOrder = user.orders.find(o => o.id === orderId);
                    if (foundOrder) {
                        order = foundOrder;
                        customer = user;
                        break;
                    }
                }
            }
            
            if (!order || !customer) {
                alert('‚ùå –ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–≤–∞—Ä—ã
            let itemsHtml = '';
            if (order.items && order.items.length > 0) {
                itemsHtml = order.items.map(item => `
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${item.name}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: center;">${item.quantity || 1} —à—Ç.</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">${item.price || 0} ‚ÇΩ</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right; font-weight: bold;">
                            ${((item.quantity || 1) * (item.price || 0)).toFixed(2)} ‚ÇΩ
                        </td>
                    </tr>
                `).join('');
            } else {
                itemsHtml = '<tr><td colspan="4" style="padding: 20px; text-align: center;">–¢–æ–≤–∞—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã</td></tr>';
            }
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #8B008B; margin: 0;">üì¶ –ó–∞–∫–∞–∑ #${orderId}</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 20px; padding: 15px; background: #FFF9FD; border-radius: 10px;">
                        <h4 style="color: #8B008B; margin-top: 0;">üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h4>
                        <p><strong>–§–ò–û:</strong> ${customer.name}</p>
                        <p><strong>Email:</strong> ${customer.email}</p>
                        <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${customer.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                        <p><strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong> ${new Date(customer.registrationDate || Date.now()).toLocaleDateString()}</p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <p><strong>üìÖ –î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞:</strong> ${new Date(order.date || orderId || Date.now()).toLocaleString()}</p>
                        <p><strong>üéØ –°—Ç–∞—Ç—É—Å:</strong> <span class="status ${getStatusClass(order.status)}">${getStatusText(order.status)}</span></p>
                    </div>
                    
                    <h4 style="color: #8B008B;">üõí –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</h4>
                    <div style="overflow-x: auto; margin-bottom: 20px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #FFF0F5;">
                                <tr>
                                    <th style="padding: 10px; text-align: left;">–¢–æ–≤–∞—Ä</th>
                                    <th style="padding: 10px; text-align: center;">–ö–æ–ª-–≤–æ</th>
                                    <th style="padding: 10px; text-align: right;">–¶–µ–Ω–∞</th>
                                    <th style="padding: 10px; text-align: right;">–°—É–º–º–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsHtml}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #FFF0F5, white); padding: 20px; border-radius: 10px; border: 2px solid #FF69B4;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="color: #8B008B; margin: 0;">üí∞ –ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</h4>
                            <h3 style="color: #C71585; margin: 0; font-size: 1.8rem;">
                                ${order.total ? order.total.toFixed(2) : '0.00'} ‚ÇΩ
                            </h3>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                                style="padding: 12px 35px; background: #8B008B; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ‚úÖ –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
        function updateOrderStatus(orderId, newStatus) {
            console.log('üîÑ –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ #' + orderId + ' –Ω–∞ ' + newStatus);
            
            const users = auth.getUsers();
            let updated = false;
            
            // –ò—â–µ–º –∑–∞–∫–∞–∑ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            users.forEach(user => {
                if (user.orders) {
                    const orderIndex = user.orders.findIndex(o => o.id === orderId);
                    if (orderIndex !== -1) {
                        user.orders[orderIndex].status = newStatus;
                        updated = true;
                    }
                }
            });
            
            if (updated) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                localStorage.setItem('users', JSON.stringify(users));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const statusCell = event.target.closest('td');
                const statusSpan = statusCell.querySelector('.status');
                
                statusSpan.textContent = getStatusText(newStatus);
                statusSpan.className = 'status ' + getStatusClass(newStatus);
                
                alert(`‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ #${orderId} –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ "${getStatusText(newStatus)}"`);
            } else {
                alert('‚ùå –û—à–∏–±–∫–∞: –∑–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData() {
            alert('üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...');
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV/Excel
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.viewCustomerOrders = viewCustomerOrders;
        window.viewOrderDetails = viewOrderDetails;
        window.updateOrderStatus = updateOrderStatus;
        window.exportData = exportData;
        
        console.log('‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
    </script>
</body>
</html>
