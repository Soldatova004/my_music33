<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - Vinyl Store</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤ */
        .status-pending { 
            background: #FFEAA7; 
            color: #E17055; 
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
        }
        .status-processing { 
            background: #74B9FF; 
            color: #0984E3; 
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
        }
        .status-shipped { 
            background: #A29BFE; 
            color: #6C5CE7; 
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
        }
        .status-delivered { 
            background: #55EFC4; 
            color: #00B894; 
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(139, 0, 139, 0.1);
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #C71585;
        }
        .admin-link {
            display: inline-block;
            margin-top: 1.5rem;
            padding: 10px 20px;
            background: #8B008B;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="logo">
                <h1>üéµ Vinyl Store</h1>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="catalog.html">üìã –ö–∞—Ç–∞–ª–æ–≥</a></li>
                <li><a href="cart.html">üõí –ö–æ—Ä–∑–∏–Ω–∞</a></li>
                <li><a href="#" onclick="auth.logout()">üö™ –í—ã–π—Ç–∏</a></li>
            </ul>
        </nav>
    </header>

    <main class="dashboard" style="padding: 2rem; max-width: 1000px; margin: 0 auto;">
        <h2 style="color: #8B008B; border-bottom: 3px solid #FF69B4; padding-bottom: 10px;">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
        
        <div style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 15px rgba(139, 0, 139, 0.1); margin-bottom: 2rem;">
            <h3 style="color: #8B008B; margin-bottom: 1rem;">üìã –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ</h3>
            <div id="user-info">
                <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
        
        <section>
            <h3 style="color: #8B008B; border-bottom: 2px solid #FF69B4; padding-bottom: 10px; margin-bottom: 1.5rem;">üì¶ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>
            <div class="orders-list" id="user-orders" style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 5px 15px rgba(139, 0, 139, 0.1);">
                <!-- –ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                <div style="text-align: center; padding: 2rem; color: #666;">
                    <div style="width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #8B008B; border-radius: 50%; margin: 0 auto; animation: spin 1s linear infinite;"></div>
                    <p style="margin-top: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
                </div>
            </div>
        </section>
    </main>

    <!-- –ü–ê–ù–ï–õ–¨ –°–û–¢–†–£–î–ù–ò–ö–ê -->
    <div id="staff-section" style="display: none; padding: 2rem; max-width: 1000px; margin: 0 auto;">
        <h3 style="color: #8B008B; border-bottom: 3px solid #FF69B4; padding-bottom: 10px;">üë®‚Äçüíº –ü–∞–Ω–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            <div class="stat-card">
                <h3>üë• –í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
                <div class="stat-number" id="staff-customers-count">0</div>
            </div>
            <div class="stat-card">
                <h3>üì¶ –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h3>
                <div class="stat-number" id="staff-active-orders">0</div>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
            <div>
                <h4 style="color: #8B008B;">‚è∞ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h4>
                <div id="recent-orders" style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 3px 10px rgba(139, 0, 139, 0.1); min-height: 200px;">
                    <!-- –ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
            
            <div>
                <h4 style="color: #8B008B;">üë§ –ù–µ–¥–∞–≤–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã</h4>
                <div id="recent-customers" style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 3px 10px rgba(139, 0, 139, 0.1); min-height: 200px;">
                    <!-- –ö–ª–∏–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <a href="admin.html" class="admin-link">
                ‚öôÔ∏è –ü–æ–ª–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            </a>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        // ===== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î –î–õ–Ø –õ–ò–ß–ù–û–ì–û –ö–ê–ë–ò–ù–ï–¢–ê =====
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞
        function getStatusText(status) {
            switch(status) {
                case 'pending': return '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ';
                case 'processing': return '–°–æ–±–∏—Ä–∞–µ—Ç—Å—è';
                case 'shipped': return '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω';
                case 'delivered': return '–î–æ—Å—Ç–∞–≤–ª–µ–Ω';
                default: return status;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ —Å—Ç–∞—Ç—É—Å–∞
        function getStatusClass(status) {
            switch(status) {
                case 'pending': return 'status-pending';
                case 'processing': return 'status-processing';
                case 'shipped': return 'status-shipped';
                case 'delivered': return 'status-delivered';
                default: return 'status-pending';
            }
        }
        
        // –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            if (!auth.currentUser) {
                window.location.href = 'login.html';
                return;
            }
            
            console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', auth.currentUser.name);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.getElementById('user-info').innerHTML = `
                <p><strong>üë§ –§–ò–û:</strong> ${auth.currentUser.name}</p>
                <p><strong>üìß Email:</strong> ${auth.currentUser.email}</p>
                <p><strong>üìû –¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${auth.currentUser.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                <p><strong>üìÖ –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong> ${new Date(auth.currentUser.registrationDate || Date.now()).toLocaleDateString()}</p>
                ${auth.currentUser.role ? `<p><strong>üé≠ –†–æ–ª—å:</strong> ${auth.currentUser.role === 'employee' ? '–°–æ—Ç—Ä—É–¥–Ω–∏–∫' : auth.currentUser.role === 'manager' ? '–ú–µ–Ω–µ–¥–∂–µ—Ä' : '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å'}</p>` : ''}
            `;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserOrders();
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
            if (auth.currentUser.role === 'employee' || auth.currentUser.role === 'manager') {
                document.getElementById('staff-section').style.display = 'block';
                loadStaffData();
            }
            
            console.log('‚úÖ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
        });
        
        // –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –ó–ê–ö–ê–ó–û–í –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        function loadUserOrders() {
            const user = auth.currentUser;
            const ordersContainer = document.getElementById('user-orders');
            
            console.log('üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
            console.log('–ó–∞–∫–∞–∑—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ:', user.orders);
            
            if (!user.orders || user.orders.length === 0) {
                ordersContainer.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <div style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;">üì¶</div>
                        <h4>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</h4>
                        <p>–°–¥–µ–ª–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</p>
                        <a href="catalog.html" style="display: inline-block; margin-top: 1rem; padding: 10px 25px; background: #8B008B; color: white; text-decoration: none; border-radius: 8px;">
                            üéµ –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                        </a>
                    </div>
                `;
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–∫–∞–∑—ã –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–µ)
            user.orders.sort((a, b) => {
                const dateA = a.date ? new Date(a.date) : new Date(a.id || 0);
                const dateB = b.date ? new Date(b.date) : new Date(b.id || 0);
                return dateB - dateA;
            });
            
            console.log('–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã:', user.orders);
            
            // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞
            ordersContainer.innerHTML = user.orders.map(order => {
                // –°—á–∏—Ç–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
                const totalItems = order.items ? 
                    order.items.reduce((sum, item) => sum + (item.quantity || 1), 0) : 0;
                
                return `
                    <div class="order-card" style="margin-bottom: 1.5rem; padding: 1.5rem; background: #FFF9FD; border-radius: 10px; border-left: 5px solid #8B008B;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4 style="color: #8B008B; margin: 0;">üì¶ –ó–∞–∫–∞–∑ #${order.id}</h4>
                            <span class="${getStatusClass(order.status || 'pending')}">
                                ${getStatusText(order.status || 'pending')}
                            </span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <p><strong>üìÖ –î–∞—Ç–∞:</strong> ${new Date(order.date || order.id || Date.now()).toLocaleDateString()}</p>
                                <p><strong>üéØ –¢–æ–≤–∞—Ä–æ–≤:</strong> ${totalItems} —à—Ç.</p>
                            </div>
                            <div style="text-align: right;">
                                <p><strong>üí∞ –°—É–º–º–∞:</strong></p>
                                <p style="color: #C71585; font-size: 1.5rem; font-weight: bold; margin: 0;">
                                    ${order.total ? order.total.toFixed(2) : '0.00'} —Ä—É–±.
                                </p>
                            </div>
                        </div>
                        
                        <button onclick="showOrderDetails(${order.id})" 
                                style="width: 100%; padding: 10px; background: linear-gradient(135deg, #8B008B, #FF69B4); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
                        </button>
                    </div>
                `;
            }).join('');
        }
        
        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –°–û–¢–†–£–î–ù–ò–ö–û–í
        function loadStaffData() {
            console.log('üë®‚Äçüíº –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...');
            
            const users = auth.getUsers();
            
            // –°—á–∏—Ç–∞–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π)
            const customers = users.filter(u => u.role === 'customer' || !u.role);
            document.getElementById('staff-customers-count').textContent = customers.length;
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–∞–∫–∞–∑—ã –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            let allOrders = [];
            users.forEach(user => {
                if (user.orders && user.orders.length > 0) {
                    user.orders.forEach(order => {
                        allOrders.push({
                            ...order,
                            userName: user.name,
                            userEmail: user.email
                        });
                    });
                }
            });
            
            // –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã (–≤—Å–µ –∫—Ä–æ–º–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö)
            const activeOrders = allOrders.filter(o => o.status !== 'delivered');
            document.getElementById('staff-active-orders').textContent = activeOrders.length;
            
            // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–∫–∞–∑–æ–≤
            const recentOrders = allOrders
                .sort((a, b) => {
                    const dateA = a.date ? new Date(a.date) : new Date(a.id || 0);
                    const dateB = b.date ? new Date(b.date) : new Date(b.id || 0);
                    return dateB - dateA;
                })
                .slice(0, 5);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã
            const ordersHtml = recentOrders.length > 0 ? 
                recentOrders.map(order => {
                    const itemsCount = order.items ? 
                        order.items.reduce((sum, item) => sum + (item.quantity || 1), 0) : 0;
                    
                    return `
                        <div style="padding: 12px; border-bottom: 1px solid #FFE4E9; display: flex; justify-content: space-between;">
                            <div>
                                <strong style="color: #8B008B;">#${order.id}</strong><br>
                                <small>${order.userName || '–ö–ª–∏–µ–Ω—Ç'}</small>
                            </div>
                            <div style="text-align: right;">
                                <strong>${order.total ? order.total.toFixed(2) : '0.00'} —Ä—É–±.</strong><br>
                                <small>${itemsCount} —à—Ç. | <span class="${getStatusClass(order.status || 'pending')}">${getStatusText(order.status || 'pending')}</span></small>
                            </div>
                        </div>
                    `;
                }).join('') :
                '<div style="text-align: center; padding: 2rem; color: #666;">üì¶ –ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>';
            
            document.getElementById('recent-orders').innerHTML = `
                <div style="max-height: 300px; overflow-y: auto;">
                    ${ordersHtml}
                </div>
            `;
            
            // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∫–ª–∏–µ–Ω—Ç–æ–≤
            const recentCustomers = customers
                .sort((a, b) => new Date(b.registrationDate || 0) - new Date(a.registrationDate || 0))
                .slice(0, 5);
            
            const customersHtml = recentCustomers.length > 0 ?
                recentCustomers.map(customer => {
                    const orderCount = customer.orders ? customer.orders.length : 0;
                    const totalSpent = customer.orders ? 
                        customer.orders.reduce((sum, order) => sum + (order.total || 0), 0) : 0;
                    
                    return `
                        <div style="padding: 12px; border-bottom: 1px solid #FFE4E9;">
                            <strong>${customer.name}</strong>
                            <div style="display: flex; justify-content: space-between; font-size: 0.9em; color: #666; margin-top: 5px;">
                                <span>${customer.email}</span>
                                <span style="color: #C71585; font-weight: bold;">
                                    ${orderCount} –∑–∞–∫. / ${totalSpent.toFixed(2)} —Ä—É–±.
                                </span>
                            </div>
                        </div>
                    `;
                }).join('') :
                '<div style="text-align: center; padding: 2rem; color: #666;">üë§ –ö–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>';
            
            document.getElementById('recent-customers').innerHTML = `
                <div style="max-height: 300px; overflow-y: auto;">
                    ${customersHtml}
                </div>
            `;
        }
        
        // –§–£–ù–ö–¶–ò–Ø –ü–û–ö–ê–ó–ê –î–ï–¢–ê–õ–ï–ô –ó–ê–ö–ê–ó–ê
        function showOrderDetails(orderId) {
            console.log('üîç –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ #' + orderId);
            
            const user = auth.currentUser;
            let order = null;
            let customerName = user.name;
            
            // –ò—â–µ–º –∑–∞–∫–∞–∑ —É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (user.orders) {
                order = user.orders.find(o => o.id === orderId);
            }
            
            // –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ - –∏—â–µ–º –≤–æ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–∞—Ö
            if (!order && (user.role === 'employee' || user.role === 'manager')) {
                const users = auth.getUsers();
                for (const u of users) {
                    if (u.orders) {
                        const foundOrder = u.orders.find(o => o.id === orderId);
                        if (foundOrder) {
                            order = foundOrder;
                            customerName = u.name;
                            break;
                        }
                    }
                }
            }
            
            if (!order) {
                alert('‚ùå –ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–≤–∞—Ä—ã
            const itemsList = order.items ? order.items.map(item => `
                <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #eee;">${item.name}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: center;">${item.quantity || 1}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">${item.price || 0} —Ä—É–±.</td>
                    <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right; font-weight: bold;">
                        ${((item.quantity || 1) * (item.price || 0)).toFixed(2)} —Ä—É–±.
                    </td>
                </tr>
            `).join('') : '<tr><td colspan="4" style="padding: 20px; text-align: center;">–¢–æ–≤–∞—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã</td></tr>';
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #8B008B; margin: 0;">üì¶ –ó–∞–∫–∞–∑ #${orderId}</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <p><strong>üë§ –ö–ª–∏–µ–Ω—Ç:</strong> ${customerName}</p>
                        <p><strong>üìÖ –î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞:</strong> ${new Date(order.date || orderId || Date.now()).toLocaleString()}</p>
                        <p><strong>üéØ –°—Ç–∞—Ç—É—Å:</strong> <span class="${getStatusClass(order.status || 'pending')}">${getStatusText(order.status || 'pending')}</span></p>
                    </div>
                    
                    <h4 style="color: #8B008B; margin-bottom: 15px;">üõí –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</h4>
                    <div style="overflow-x: auto; margin-bottom: 20px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #FFF0F5;">
                                <tr>
                                    <th style="padding: 10px; text-align: left;">–¢–æ–≤–∞—Ä</th>
                                    <th style="padding: 10px; text-align: center;">–ö–æ–ª-–≤–æ</th>
                                    <th style="padding: 10px; text-align: right;">–¶–µ–Ω–∞</th>
                                    <th style="padding: 10px; text-align: right;">–°—É–º–º–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsList}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #FFF0F5, white); padding: 20px; border-radius: 10px; border: 2px solid #FF69B4;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="color: #8B008B; margin: 0;">üí∞ –ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</h4>
                            <h3 style="color: #C71585; margin: 0; font-size: 1.8rem;">
                                ${order.total ? order.total.toFixed(2) : '0.00'} —Ä—É–±.
                            </h3>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                                style="padding: 12px 35px; background: #8B008B; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ‚úÖ –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.showOrderDetails = showOrderDetails;
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
