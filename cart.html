<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–∑–∏–Ω–∞ - Vinyl Store</title>
</head>
<body style="font-family: Arial; margin: 0; background: #FFF0F5;">
    <!-- –®–ê–ü–ö–ê -->
    <div style="background: #8B008B; color: white; padding: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1 style="margin: 0;">üéµ Vinyl Store</h1>
            <div>
                <a href="index.html" style="color: white; margin-right: 15px;">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                <a href="catalog.html" style="color: white; margin-right: 15px;">üìã –ö–∞—Ç–∞–ª–æ–≥</a>
                <a href="cart.html" style="color: white; margin-right: 15px;">üõí –ö–æ—Ä–∑–∏–Ω–∞ (<span id="cart-count">0</span>)</a>
                <a href="login.html" style="color: white;">üîê –í–æ–π—Ç–∏</a>
            </div>
        </div>
    </div>

    <!-- –ö–û–†–ó–ò–ù–ê -->
    <div style="max-width: 800px; margin: 30px auto; padding: 20px;">
        <h2 style="color: #8B008B; text-align: center;">üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
        
        <!-- –¢–û–í–ê–†–´ –í –ö–û–†–ó–ò–ù–ï -->
        <div id="cart-items" style="margin: 30px 0;">
            <!-- –¢–æ–≤–∞—Ä—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
        </div>
        
        <!-- –ò–¢–û–ì–û -->
        <div style="text-align: right; margin-top: 30px; padding-top: 20px; border-top: 3px solid #FF69B4;">
            <h3 style="color: #8B008B;">–ò—Ç–æ–≥–æ: <span id="total-price">0</span> ‚ÇΩ</h3>
            <button onclick="checkout()" style="padding: 15px 40px; background: #8B008B; color: white; border: none; border-radius: 10px; font-size: 1.2rem; cursor: pointer; font-weight: bold;">
                üí≥ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // –ü–û–ö–ê–ó–ê–¢–¨ –ö–û–†–ó–ò–ù–£
        function showCart() {
            const container = document.getElementById('cart-items');
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 4rem;">üõí</div>
                        <h3>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞</p>
                        <a href="catalog.html" style="display: inline-block; margin-top: 15px; padding: 10px 25px; background: #8B008B; color: white; text-decoration: none; border-radius: 8px;">
                            –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                        </a>
                    </div>
                `;
                document.getElementById('total-price').textContent = '0';
                updateCartCount();
                return;
            }
            
            let total = 0;
            let html = '';
            
            cart.forEach(item => {
                const itemTotal = item.price * (item.quantity || 1);
                total += itemTotal;
                
                html += `
                    <div style="display: flex; align-items: center; padding: 15px; margin-bottom: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <div style="background: #8B008B; width: 60px; height: 60px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; margin-right: 15px;">
                            üéµ
                        </div>
                        
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 5px 0; color: #8B008B;">${item.name}</h4>
                            <p style="margin: 0; color: #666;">–¶–µ–Ω–∞: ${item.price} ‚ÇΩ</p>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 10px; margin-right: 20px;">
                            <button onclick="updateCartQuantity(${item.id}, -1)" style="background: #FF69B4; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">-</button>
                            <span style="font-weight: bold; min-width: 30px; text-align: center;">${item.quantity || 1}</span>
                            <button onclick="updateCartQuantity(${item.id}, 1)" style="background: #FF69B4; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">+</button>
                        </div>
                        
                        <div style="text-align: right;">
                            <p style="color: #C71585; font-weight: bold; font-size: 1.3rem; margin: 0 0 10px 0;">${itemTotal} ‚ÇΩ</p>
                            <button onclick="removeFromCart(${item.id})" style="background: none; border: none; color: #FF69B4; cursor: pointer; font-size: 0.9rem;">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            document.getElementById('total-price').textContent = total;
            updateCartCount();
        }

        // –ò–ó–ú–ï–ù–ò–¢–¨ –ö–û–õ–ò–ß–ï–°–¢–í–û –í –ö–û–†–ó–ò–ù–ï
        function updateCartQuantity(productId, change) {
            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const item = cart.find(item => item.id === productId);
            
            if (item) {
                const newQuantity = (item.quantity || 1) + change;
                if (newQuantity < 1) {
                    // –ï—Å–ª–∏ 0 - —É–¥–∞–ª—è–µ–º
                    cart = cart.filter(item => item.id !== productId);
                } else {
                    item.quantity = newQuantity;
                }
                
                localStorage.setItem('cart', JSON.stringify(cart));
                showCart();
            }
        }

        // –£–î–ê–õ–ò–¢–¨ –ò–ó –ö–û–†–ó–ò–ù–´
        function removeFromCart(productId) {
            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            showCart();
            alert('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω');
        }

        // –û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó
        function checkout() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            
            if (cart.length === 0) {
                alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (!user) {
                alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞');
                window.location.href = 'login.html';
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –∑–∞–∫–∞–∑
            const total = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
            const order = {
                id: Date.now(),
                items: [...cart],
                total: total,
                date: new Date().toISOString(),
                status: 'pending'
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–∞–∑ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.email === user.email);
            
            if (userIndex !== -1) {
                if (!users[userIndex].orders) {
                    users[userIndex].orders = [];
                }
                users[userIndex].orders.push(order);
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
            localStorage.removeItem('cart');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            alert(`‚úÖ –ó–∞–∫–∞–∑ #${order.id} –æ—Ñ–æ—Ä–º–ª–µ–Ω!\n–°—É–º–º–∞: ${total} ‚ÇΩ`);
            
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
            window.location.href = 'dashboard.html';
        }

        // –û–ë–ù–û–í–ò–¢–¨ –°–ß–ï–¢–ß–ò–ö
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const count = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
            
            const counter = document.getElementById('cart-count');
            if (counter) {
                counter.textContent = count;
            }
        }

        // –ó–ê–ì–†–£–ó–ò–¢–¨ –ü–†–ò –°–¢–ê–†–¢–ï
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–ö–æ—Ä–∑–∏–Ω–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            showCart();
            updateCartCount();
        });
    </script>
</body>
</html>
